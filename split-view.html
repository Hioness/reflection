<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reflection: Review & Write</title>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
    <link rel="apple-touch-icon" href="/assets/apple-touch-icon.svg">
    <link rel="manifest" href="/site.webmanifest">
    <meta name="theme-color" content="#333333">
    <style>
        /* --- Typography Imports --- */
        @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600&family=Inter:wght@300;600&family=JetBrains+Mono:wght@300&display=swap');

        /* --- Global Reset & Variables --- */
        :root {
            --bg-color: #F0EEE6;
            --text-color: #333333;
            --art-color-right: #A09E96;
            --toolbar-bg: rgba(240, 238, 230, 0.95);
            --toolbar-text: #666;
            --toolbar-text-hover: #000;
            --font-stack: 'Courier New', Courier, monospace;
            --divider-width: 6px;
            --min-panel-width: 300px;
        }

        /* Dark mode color scheme */
        body.dark-mode {
            --bg-color: #1a1a1a;
            --text-color: #e0e0e0;
            --art-color-right: #5a5a5a;
            --toolbar-bg: rgba(26, 26, 26, 0.95);
            --toolbar-text: #999;
            --toolbar-text-hover: #fff;
        }

        * {
            box-sizing: border-box;
        }

        html,
        body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-stack);
        }

        /* --- Split Container --- */
        .split-container {
            display: flex;
            height: 100vh;
            width: 100vw;
        }

        /* --- Panels --- */
        .panel {
            position: relative;
            height: 100%;
            overflow: hidden;
        }

        .panel-left {
            flex: 0 0 40%;
            min-width: var(--min-panel-width);
        }

        .panel-right {
            flex: 0 0 calc(60% - var(--divider-width));
            min-width: var(--min-panel-width);
        }

        /* --- Divider --- */
        .divider {
            width: var(--divider-width);
            background: linear-gradient(to right, rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.05));
            cursor: col-resize;
            flex-shrink: 0;
            position: relative;
            z-index: 100;
            transition: background 0.2s ease;
        }

        .divider:hover,
        .divider.dragging {
            background: linear-gradient(to right, rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.1));
        }

        .divider::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 2px;
            height: 40px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 1px;
        }

        /* --- ASCII Background Layers --- */
        .ascii-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
            overflow: hidden;
        }

        .ascii-layer pre {
            font-size: 14px;
            line-height: 14px;
            white-space: pre;
            margin: 0;
            position: absolute;
            top: 0;
            left: 0;
        }

        #right-ascii {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #right-ascii pre {
            color: var(--art-color-right);
            opacity: 0.08;
            position: relative;
        }

        /* --- Panel Content --- */
        .panel-content {
            position: relative;
            z-index: 10;
            height: 100%;
            overflow-y: auto;
            scrollbar-width: thin;
        }

        /* ========================================
           LEFT PANEL: Annual Review Template Styles
           ======================================== */
        .panel-left .panel-content {
            max-width: 700px;
            margin: 0 auto;
            padding: 60px 30px;
        }

        .panel-left h1,
        .panel-left h2 {
            font-weight: normal;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-top: 3em;
            margin-bottom: 1em;
            border-bottom: 1px solid var(--text-color);
            padding-bottom: 0.5em;
            opacity: 0.9;
        }

        .panel-left h1 {
            font-size: 1.8rem;
            margin-top: 0;
            text-align: center;
            border-bottom: none;
            margin-bottom: 2em;
        }

        .panel-left .subtitle {
            text-align: center;
            font-style: italic;
            margin-bottom: 4em;
            opacity: 0.7;
        }

        .panel-left .question-group {
            margin-bottom: 2em;
        }

        .panel-left ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .panel-left li {
            margin-bottom: 1.5em;
            padding-left: 1.5em;
            position: relative;
            transition: opacity 0.3s ease;
            cursor: text;
        }

        .panel-left li::before {
            content: "—";
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0.5;
        }

        .panel-left li:hover {
            opacity: 0.8;
        }

        .panel-left .memories-list {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0 20px;
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .panel-left .memories-list li {
            margin-bottom: 1.5em;
            padding-left: 1.5em;
            position: relative;
            cursor: text;
        }

        .panel-left .memories-list li::before {
            content: "—";
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0.5;
        }

        .panel-left .memories-list li:hover {
            opacity: 0.8;
        }



        /* ========================================
           RIGHT PANEL: Zen Writer Styles
           ======================================== */
        .panel-right .panel-content {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 60px 20px;
        }

        #editor-container {
            width: 100%;
            max-width: 600px;
            height: calc(100vh - 120px);
            overflow-y: auto;
            scrollbar-width: none;
        }

        #editor-container::-webkit-scrollbar {
            display: none;
        }

        #editor {
            outline: none;
            width: 100%;
            min-height: 100%;
            padding-bottom: 20vh;
        }

        [contenteditable]:empty:before {
            content: attr(placeholder);
            color: #999;
            opacity: 0.5;
            display: block;
        }

        /* Font Styles */
        .font-serif {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.3rem;
            line-height: 1.6;
        }

        .font-sans {
            font-family: 'Inter', sans-serif;
            font-size: 1.1rem;
            line-height: 1.7;
            letter-spacing: -0.01em;
        }

        .font-mono {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.95rem;
            line-height: 1.8;
        }

        /* Editor formatting */
        #editor h1 {
            font-size: 2em;
            margin-top: 1em;
            margin-bottom: 0.5em;
            font-weight: 600;
            border-bottom: 1px solid var(--art-color-right);
            padding-bottom: 10px;
        }

        #editor h2 {
            font-size: 1.5em;
            margin-top: 1em;
            margin-bottom: 0.5em;
            font-weight: 600;
        }

        /* Toolbar */
        #toolbar {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            gap: 15px;
            padding: 10px 20px;
            background: var(--toolbar-bg);
            border-radius: 50px;
            opacity: 0;
            transition: opacity 0.4s ease, background 0.3s ease;
            z-index: 200;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        .panel-right:hover #toolbar,
        #toolbar:hover {
            opacity: 1;
        }

        .tool-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            color: var(--toolbar-text);
            transition: color 0.2s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .tool-btn:hover {
            color: var(--toolbar-text-hover);
        }

        .tool-separator {
            width: 1px;
            background: #ccc;
            height: 12px;
            align-self: center;
        }

        /* Prevent text selection during resize */
        body.resizing {
            user-select: none;
            cursor: col-resize;
        }

        body.resizing * {
            cursor: col-resize !important;
        }

/* Theme Toggle */
        #theme-toggle {
            position: fixed;
            top: 30px;
            right: 30px;
            background: none;
            border: 1px solid var(--text-color);
            cursor: pointer;
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            color: var(--text-color);
            padding: 8px 16px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            transition: all 0.2s ease;
            z-index: 300;
            opacity: 0.6;
            border-radius: 3px;
        }

        #theme-toggle:hover {
            opacity: 1;
            background: var(--text-color);
            color: var(--bg-color);
        }

        /* Version Switch */
        #version-switch {
            position: fixed;
            top: 30px;
            left: 30px;
            background: none;
            border: 1px solid var(--text-color);
            cursor: pointer;
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            color: var(--text-color);
            padding: 8px 16px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            transition: all 0.2s ease;
            z-index: 300;
            opacity: 0.6;
            border-radius: 3px;
            text-decoration: none;
        }

        #version-switch:hover {
            opacity: 1;
            background: var(--text-color);
            color: var(--bg-color);
        }
    </style>
</head>

<body>
    <!-- Version Switch -->
    <a href="/mobile.html" id="version-switch">MOBILE</a>

    <!-- Theme Toggle -->
    <button id="theme-toggle" onclick="toggleDarkMode()">DARK</button>

    <div class="split-container">
        <!-- LEFT PANEL: Annual Review Template -->
        <div class="panel panel-left" id="left-panel">
            <div class="panel-content">
                <h1>Modern Wisdom<br>Annual Review</h1>
                <p class="subtitle">A structured reflection and planning workbook.</p>

                <section id="review">
                    <h2>Review</h2>
                    <div class="question-group">
                        <ul>
                            <li>How has this year gone?</li>
                            <li>What went well?</li>
                            <li>What went badly?</li>
                            <li>Why?</li>
                            <li>What lessons did I learn?</li>
                            <li>What habit or system accounted for most of my success?</li>
                            <li>What are the most valuable ways I spend my time?</li>
                            <li>How can I find more time for this?</li>
                            <li>What brought me the most happiness?</li>
                            <li>How can I help these activities to happen more often?</li>
                            <li>Who are the people that had the greatest impact on me?</li>
                            <li>How can I see and collaborate with them more?</li>
                            <li>What did I expect to complete, but didn't?</li>
                            <li>Is this still an important goal of mine? If so, how can I make future follow-through
                                more likely?</li>
                            <li>What are the least valuable ways I am spending my time?</li>
                            <li>How can I prevent myself from continuing to spend time in this way?</li>
                            <li>How have my goals or priorities shifted over the last few months?</li>
                            <li>Is there anything I am still doing that is no longer in alignment? Why?</li>
                        </ul>
                    </div>
                </section>

                <section id="memories">
                    <h2>Memories</h2>
                    <ul class="memories-list">
                        <li>Best Surprise</li>
                        <li>Best Meal</li>
                        <li>Coolest New Experience</li>
                        <li>Favourite Weekend</li>
                        <li>Favourite First Meeting</li>
                        <li>Favourite New City</li>
                        <li>Favourite New Emotion</li>
                        <li>Favourite New Walk</li>
                        <li>Favourite New Friend</li>
                        <li>Favourite Tour</li>
                        <li>Favourite Day</li>
                        <li>Most Intense Week</li>
                        <li>Best Sex</li>
                        <li>Favourite Artist</li>
                        <li>Favourite Song</li>
                        <li>Favourite Quote</li>
                    </ul>
                </section>

                <section id="plan">
                    <h2>Plan</h2>
                    <div class="question-group">
                        <ul>
                            <li>What would I do this year if I wanted to make 85 year old me miserable?</li>
                            <li>What would 85 year old me wish I did more of?</li>
                            <li>What are the things I do to make my day go great?</li>
                            <li>What things make my days go terribly?</li>
                            <li>What do I think is productive that isn't?</li>
                            <li>What is productive that I don't realise?</li>
                            <li>What do I want to do less of with my time?</li>
                            <li>What do I want to do more of with my time?</li>
                            <li>What does an ideal normal day look like? Write it out.</li>
                            <li>What conversations do I need to have?</li>
                            <li>What are the habits I'm committing to starting and stopping?</li>
                        </ul>
                    </div>
                </section>

                <section id="final-thoughts">
                    <h2>Final Thoughts</h2>
                    <div class="question-group">
                        <ul>
                            <li>What would have had to have happened by the end of next year for me to look back on the
                                year and consider it a success?</li>
                            <li>Who do I need to become for next year's chapter of my life story to turn out the way I
                                would write it?</li>
                            <li>Knowing what I know now, what advice would I give to myself 12 months ago?</li>
                        </ul>
                    </div>
                </section>


            </div>
        </div>

        <!-- DIVIDER -->
        <div class="divider" id="divider"></div>

        <!-- RIGHT PANEL: Zen Writer -->
        <div class="panel panel-right" id="right-panel">
            <div class="ascii-layer" id="right-ascii">
                <pre id="right-ascii-pre"></pre>
            </div>
            <div class="panel-content">
                <div id="editor-container">
                    <div id="editor" class="font-mono" contenteditable="true" placeholder="Start writing..."></div>
                </div>
                <div id="toolbar">
                    <button class="tool-btn" onclick="format('bold')">Bold</button>
                    <button class="tool-btn" onclick="format('italic')">Italic</button>
                    <div class="tool-separator"></div>
                    <button class="tool-btn" onclick="format('h1')">H1</button>
                    <button class="tool-btn" onclick="format('h2')">H2</button>
                    <div class="tool-separator"></div>
                    <button class="tool-btn" onclick="cycleFont()" id="font-btn">Mono</button>
                    <div class="tool-separator"></div>
                    <button class="tool-btn" onclick="copyContent()" id="copy-btn">Copy</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // =============================================
        // RESIZABLE SPLIT PANEL
        // =============================================
        const divider = document.getElementById('divider');
        const leftPanel = document.getElementById('left-panel');
        const rightPanel = document.getElementById('right-panel');
        const container = document.querySelector('.split-container');

        const MIN_PANEL_WIDTH = 300; // px
        let isDragging = false;

        divider.addEventListener('mousedown', startDrag);
        divider.addEventListener('touchstart', startDrag, { passive: false });

        function startDrag(e) {
            e.preventDefault();
            isDragging = true;
            document.body.classList.add('resizing');
            divider.classList.add('dragging');

            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', stopDrag);
            document.addEventListener('touchmove', drag, { passive: false });
            document.addEventListener('touchend', stopDrag);
        }

        function drag(e) {
            if (!isDragging) return;
            e.preventDefault();

            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const containerRect = container.getBoundingClientRect();
            const containerWidth = containerRect.width;
            const dividerWidth = divider.offsetWidth;

            // Calculate new left panel width
            let newLeftWidth = clientX - containerRect.left;

            // Enforce minimum widths
            const maxLeftWidth = containerWidth - dividerWidth - MIN_PANEL_WIDTH;
            newLeftWidth = Math.max(MIN_PANEL_WIDTH, Math.min(newLeftWidth, maxLeftWidth));

            // Calculate percentages
            const leftPercent = (newLeftWidth / containerWidth) * 100;
            const rightPercent = ((containerWidth - newLeftWidth - dividerWidth) / containerWidth) * 100;

            leftPanel.style.flex = `0 0 ${leftPercent}%`;
            rightPanel.style.flex = `0 0 ${rightPercent}%`;

            // Trigger resize for ASCII animations
            resizeRightAscii();
        }

        function stopDrag() {
            isDragging = false;
            document.body.classList.remove('resizing');
            divider.classList.remove('dragging');

            document.removeEventListener('mousemove', drag);
            document.removeEventListener('mouseup', stopDrag);
            document.removeEventListener('touchmove', drag);
            document.removeEventListener('touchend', stopDrag);
        }



        // =============================================
        // RIGHT PANEL: ASCII ANIMATION (Zen Wave)
        // =============================================
        const rightCanvas = document.getElementById('right-ascii-pre');
        let rightWidth, rightHeight;
        let rightFrame = 0;

        function resizeRightAscii() {
            // Fixed smaller size for centered, subtle background
            rightWidth = 40;
            rightHeight = 20;
        }

        function drawRightAscii() {
            const t = rightFrame * 0.02;
            let output = '';

            for (let y = 0; y < rightHeight; y++) {
                for (let x = 0; x < rightWidth; x++) {
                    const value = Math.sin(x * 0.15 + t) * Math.cos(y * 0.15 - t * 0.5);

                    if (value > 0.6) output += '█';
                    else if (value > 0.3) output += '▓';
                    else if (value > 0) output += '▒';
                    else if (value > -0.2) output += '░';
                    else output += '·';
                }
                output += '\n';
            }

            rightCanvas.textContent = output;
            rightFrame++;
            requestAnimationFrame(drawRightAscii);
        }

        // Right panel click effect
        rightPanel.addEventListener('mousedown', () => {
            rightFrame += 10;
        });

        // =============================================
        // ZEN WRITER: Editor Functions
        // =============================================
        function format(command) {
            if (command === 'h1' || command === 'h2') {
                document.execCommand('formatBlock', false, command);
            } else {
                document.execCommand(command, false, null);
            }
            document.getElementById('editor').focus();
        }

        const fonts = ['font-mono', 'font-serif', 'font-sans'];
        const fontNames = ['Mono', 'Serif', 'Sans'];
        let currentFontIndex = 0;

        function cycleFont() {
            const editor = document.getElementById('editor');
            const btn = document.getElementById('font-btn');

            editor.classList.remove(fonts[currentFontIndex]);
            currentFontIndex = (currentFontIndex + 1) % fonts.length;
            editor.classList.add(fonts[currentFontIndex]);
            btn.textContent = fontNames[currentFontIndex];

            // Save font preference
            localStorage.setItem('zenwriter-font', currentFontIndex);
        }

        // =============================================
        // CLIPBOARD HELPER (with fallback)
        // =============================================
        function copyToClipboard(text, button, successText = 'Copied!') {
            const originalText = button.textContent;

            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => {
                    button.textContent = successText;
                    setTimeout(() => button.textContent = originalText, 1500);
                }).catch(() => {
                    fallbackCopy(text, button, successText, originalText);
                });
            } else {
                fallbackCopy(text, button, successText, originalText);
            }
        }

        function fallbackCopy(text, button, successText, originalText) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.left = '-9999px';
            textarea.style.top = '-9999px';
            document.body.appendChild(textarea);
            textarea.focus();
            textarea.select();

            try {
                document.execCommand('copy');
                button.textContent = successText;
                setTimeout(() => button.textContent = originalText, 1500);
            } catch (err) {
                button.textContent = 'Copy failed';
                setTimeout(() => button.textContent = originalText, 1500);
            }

            document.body.removeChild(textarea);
        }

        // =============================================
        // COPY FUNCTION
        // =============================================
        function copyContent() {
            const editor = document.getElementById('editor');
            const btn = document.getElementById('copy-btn');
            copyToClipboard(editor.innerText, btn);
        }

        // =============================================
        // LOCAL STORAGE PERSISTENCE
        // =============================================
        const STORAGE_KEY = 'zenwriter-content';
        const editor = document.getElementById('editor');
        let saveTimeout;

        // Load saved content on page load
        function loadSavedContent() {
            const savedContent = localStorage.getItem(STORAGE_KEY);
            if (savedContent) {
                editor.innerHTML = savedContent;
            }

            // Load saved font preference
            const savedFont = localStorage.getItem('zenwriter-font');
            if (savedFont !== null) {
                const fontIndex = parseInt(savedFont, 10);
                if (fontIndex >= 0 && fontIndex < fonts.length) {
                    editor.classList.remove(fonts[currentFontIndex]);
                    currentFontIndex = fontIndex;
                    editor.classList.add(fonts[currentFontIndex]);
                    document.getElementById('font-btn').textContent = fontNames[currentFontIndex];
                }
            }
        }

        // Save content with debounce (saves 500ms after user stops typing)
        function saveContent() {
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                localStorage.setItem(STORAGE_KEY, editor.innerHTML);
            }, 500);
        }

        // Listen for input changes
        editor.addEventListener('input', saveContent);

        // =============================================
        // DARK MODE TOGGLE
        // =============================================
        const THEME_KEY = 'reflection-global-theme';

        function toggleDarkMode() {
            const body = document.body;
            const themeBtn = document.getElementById('theme-toggle');
            const isDark = body.classList.toggle('dark-mode');

            // label = current state
            themeBtn.textContent = isDark ? 'DARK' : 'LIGHT';

            // Save preference to localStorage
            localStorage.setItem(THEME_KEY, isDark ? 'dark' : 'light');
        }

// Load saved theme preference (defaults to dark mode)
        function loadTheme() {
            const savedTheme = localStorage.getItem(THEME_KEY);
            const themeBtn = document.getElementById('theme-toggle');

            // Default to dark mode globally
            const isDark = savedTheme === null ? true : savedTheme === 'dark';

            if (isDark) {
                document.body.classList.add('dark-mode');
                themeBtn.textContent = 'DARK';
            } else {
                themeBtn.textContent = 'LIGHT';
            }
        }



// =============================================
        // CROSS-VERSION THEME SYNC
        // =============================================
        
        // Listen for theme changes from other tabs/pages
        window.addEventListener('storage', (e) => {
            if (e.key === THEME_KEY) {
                loadTheme();
            }
        });

        // =============================================
        // INITIALIZATION
        // =============================================
        window.addEventListener('resize', () => {
            resizeRightAscii();
        });

        // Initial setup
        loadTheme();
        loadSavedContent();
        resizeRightAscii();
        drawRightAscii();
    </script>
</body>

</html>